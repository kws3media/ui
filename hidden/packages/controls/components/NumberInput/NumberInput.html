<div class="field has-addons">
  <div class="control">
    <button type="button" class="button is-{size} is-{minus_button_color}" style="box-shadow:none;" on:click="count(-1)" disabled="{disabled || value <= min}">
      <Icon icon="{minus_icon}" size="small" icon_class="has-text-{minus_icon_color}"/>
    </button>
  </div>
  <div class="control is-{fullwidth ? 'expanded' : 'narrow'}">
    <input
      ref:input
      class="input has-text-centered is-{size} is-{((value < min) || (value > max)) ? 'danger' : ''}"
      type="number"
      min="{min}"
      max="{max}"
      step="{step}"
      {disabled}
      bind:value
      on:blur="isBlurred()"
      on:focus="isFocused()"
    />
  </div>
  <div class="control">
    <button type="button" class="button is-{size} is-{plus_button_color}" style="box-shadow:none;" on:click="count(+1)" disabled="{disabled || value>=max}">
      <Icon icon="{plus_icon}" size="small" icon_class="has-text-{plus_icon_color}"/>
    </button>
  </div>
</div>

<style>
  input[type=number]::-webkit-inner-spin-button,
  input[type=number]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
  }
  input[type=number]::-moz-inner-spin-button,
  input[type=number]::-moz-outer-spin-button {
      -moz-appearance: none;
      margin: 0;
  }
  input[type=number]::inner-spin-button,
  input[type=number]::outer-spin-button {
      appearance: none;
      margin: 0;
  }
</style>

<script>
  import {Icon} from '@kws3/helpers';

  export default {
    components: {
      Icon
    },
    data() {
      return {
        size:'',
        value: null,
        step: 1,
        min: 0,
        max: 100,
        disabled: false,
        fullwidth: false,
        minus_icon:'minus',
        minus_icon_color:'danger',
        minus_button_color: '',
        plus_icon:'plus',
        plus_icon_color:'success',
        plus_button_color: '',
        _has_focus: 0
      }
    },
    oncreate(){
      this.on('state', ({changed, current}) => {
        if(changed.value && !current._has_focus){
          this.validateInput();
        }
      });
      this.validateInput();
    },
    methods:{
      isFocused(){
        this.set({_has_focus: true});
      },
      isBlurred(){
        this.validateInput();
        this.set({_has_focus: false});
      },
      count(i){
        let {step, value, min} = this.get();
        if(typeof value == 'undefined' || value === null) value = min;
        value = (Number(value) + (i * step));
        if(step % 1 != 0) value = value.toFixed(1);
        this.set({value});
        this.fire('change');
      },
      validateInput(){
        let {value, min, max} = this.get();

        if(typeof value == 'undefined' || value === null) value = min;

        if(value < min) value = min;
        if(value > max) value = max;

        this.set({value});
        this.fire('change');


      }
    }
  }
</script>