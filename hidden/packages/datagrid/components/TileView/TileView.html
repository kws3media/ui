<div class="columns is-multiline">
  {#each data as row, row_index (row[iteration_key])}
    <div class="column is-{column_size}">
      <Transition {transition} y="{20}" delay="{20*row_index}">
        <TileHOC
          target={mainTileComponent}
          on:*="fire('_forwardEvent', event)"
          {row_index}
          {column_keys}
          {clickableRows}
          {isVisible}
          {transforms}
          {classNames}
          {styles}
          {row}
        />
      </Transition>
    </div>
  {/each}
</div>

<script>
  import TileViewItem from './TileViewItem.html';
  import Transition from '@kws3/transitions';
  import {createHOC} from '@kws3/helpers';

  export default {
    components:{
      TileHOC: createHOC(),
      Transition
    },
    data(){
      return {
        iteration_key: 'id',
        data:[],
        transition: false,
        tileItemComponent: null,
        per_row: 3,
        clickableRows: false
      }
    },
    computed: {
      mainTileComponent: ({tileItemComponent}) => (tileItemComponent ? tileItemComponent : TileViewItem),
      column_size: ({ per_row }) => (per_row < 12 ? Math.floor(12/per_row) : 12),
      column_keys: ({ columns }) => (columns ? Object.keys(columns) : []),
      isVisible: function ({ visibilityMap }) {
        return function (column) {
          if (visibilityMap && typeof visibilityMap[column] != 'undefined' && visibilityMap[column] === false) {
            return false;
          }
          return true;
        }
      },
      transforms: function({ valueTransformers }){
        return function(column, row){
          if(valueTransformers && valueTransformers[column] && row){
            return valueTransformers[column](row[column], row);
          }

          return row && row[column] ? row[column] : '';
        }
      },
      classNames: function({ classTransformers }){
        return function(column, row){
          if(classTransformers && classTransformers[column] && row){
            return classTransformers[column](row[column], row);
          }

          var map = {
            title: 'title is-4',
            subtitle: 'subtitle is-5'
          }

          return map[column] ? map[column] : '';
        }
      },
      styles: function({ styleTransformers }){
        return function(column, row){
          if(styleTransformers && styleTransformers[column] && row){
            return styleTransformers[column](row[column], row);
          }

          return '';
        }
      }
    },
    oncreate(){
      this.on('_forwardEvent', (e) => {
        this.fire(e.name, e.event);
      });
    }
  }

</script>